---
title : 스케일 아웃
layout: post
---

>## SPOF

Single Point Of Failure. 단일 장애점  
서버가 두 대인 경우(웹 서버 1대, 디비 1대)  
시스템 구성 중 한 개가 망가지면 전체가 중단됨  

>## 로드 밸런싱

Load Balancing  
서버에 트래픽을 분산시켜 서버당 부하를 줄임  

>## 고가용성

High Availability, HA  
여러대의 서버가 있고 평소에는 액티브 서버만 사용하다가  
장애 발생 시 대기 서버를 이용  
한 번에 하나의 서버를 사용  
트래픽을 분산하지는 않음  

>## DNS RR

DNS 서버의 캐쉬가 문제  
저렴하지만 업데이트가 바로 되지 않아서 빨리 대응할 수 없음  
JVM은 한 번 DNS lookup을 하면 DNS의 TTL과 상관없이 해당 VM이 종료될 때 까지 계속 캐싱 

>## L4 스위치

로드밸런싱 수행  
VIP(Virtual IP, 서버 그룹 대표 IP)를 통해 관리  
L4 스위치 가상서버가 존재  

1. Proxy 모드 
모든 트래픽들이 L4를 거침  
L4의 병목현상 발생 가능  

2. DSR 모드
Direct Server Return. 
서버에서 클라이언트로 Response 응답 시 L4를 거치지 않고 다이렉트로 클라이언트에게 전달
Client - L4 - Server - Client  
**요청 패킷이 작은** 일반적인 웹 요청, 파일 다운로드에 적합  
**요청 패킷이 많은** 파일 업로드, SMTP에는 적합하지 않음  

* 대용량 파일 업로드 2 단계로 나누어 동작  
1. 클라이언트 -> L4 : 요청  
2. L4 -> 웹 서버 -> 클라이언트 : 웹 서버가 자신의 IP를 클라이언트에게 알려줌  
3. 클라이언트 -> 웹 서버 : L4를 거치지 않고 서버로 바로 업로드 요청  

>## 여러 대의 서버

만약 양 쪽 다 50% 이상의 트래픽을 받고 있는 경우 한 쪽이 죽으면 남은 한 쪽이 100%를 넘는 트래픽을 받게 되므로 문제가 됨  
서버가 여러대 존재하는 경우 서버간 동일한 세션 데이터를 가지고 있지 못하므로 별도의 처리가 필요  
쿠키는 데이터 양에 제한이 있음  
웹 서버 로컬 디스크에 공유되는 정보를 저장할 수 없음  
서버간 컨텐트 공유 : DB, NAS(Network Attached Storage)/NFS(Network File System), Redis  

---
참고   
<http://d2.naver.com/helloworld/284659>    
<https://www.slideshare.net/cybaek/201403>