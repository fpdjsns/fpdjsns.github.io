---
title : 토비의 스프링 3장
layout: post
---

토비의 스프링 3.1 3장(템플릿) 내용을 정리한 글입니다.  

---

>## 템플릿

변경이 거의 없는 부분을 변경이 자주 일어나는 부분에서 분리시키는 방법  

>## try/catch/finally

try : 예외가 발생할 수 있는 부분  
catch : 예외 발생 시 할 작업들이 있는 부분  
finally : 예외 발생 유무와 상관없이 반드시 실행되는 부분  

>## 디자인 패턴 - 분리와 재사용

### **메소드 추출**
변하는 부분을 메소드로 빼낸다.  
문제점 : 기존의 메소드 추출 리팩토링과반대로 분리시키고 남은 메소드가 재사용 불가.

### **템플릿 메소드 패턴 적용**
상속이용  
변하지 않는 부분을 슈퍼클래스, 변하는 부분을 추상 메소드로 정의하고 서브클래스에서 이를 오버라이드하여 사용하게 함  
문제점 : 로직마다 상속을 통해 클래스를 새로 만들어야 한다.  

### **전략 패턴 적용**
오프젝트를 분리  
클래스 레벨에서는 인터페이스를 통해서만 의존하게 함  
개방 폐쇄 원칙(OCP)를 잘 지키는 구조  
템플릿 메소드 패턴보다 유연, 확장성 뛰어남  
문제점 : 컨텍스트 안에서 구체적인 전략 클래스를 사용하게 고정  

### **DI 적용을 위한 클라이언트/컨텍스트 분리**
전략 패턴은 Context를 사용하는 클라이언트가 어떤 전략을 사용할지 정함  
즉, 클라이언트가 컨텍스트에게 전략을 정해서 전달  

>## 중첩 클래스

다른 클래스 내부에 정의되는 클래스
### 1. 스태틱(static) 클래스
독립적으로 오브젝트로 만들어질 수 있는 클래스
### 2. 내부(inner) 클래스
자신이 정의된 클래스 오브젝트 안에서만 만들어질 수 있는 클래스  
범위(scope)에 따라 3가지로 다시 분류
1. 멤버 내부 클래스 : 오브젝트 레벨
2. 로컬 클래스 : 메소드 레벨
3. 익명 내부 클래스 : 선언된 위치에 따라 다름

>## 로컬 클래스

전략 클래스를 **내부 클래스**로 정의  
클래스파일이 많아지는 문제 해결  
특정 메소드에만 사용되는 경우 **로컬 클래스**로 만들 수 있음
메소드 레벨에 정의됨  

장점 
1. 메소드마다 추가했던 클래스파일 줄일 수 있음  
2. 가독성이 좋음  
3. 선언된 곳의 정보에 접근 가능(내부 클래스니까)하므로 오브젝트 전달할 필요가 없음  

내부 클래스에서 외부 변수 사용시 외부 변수는 final로 선언  
```java
public void 함수이름(final Mail mail){ //외부 변수 mail이 final로 선언되어 있으므로
  class 내부클래스이름{
    public void 내부클래스함수(){
      mail.getNo(); //내부 클래스에서 접근 가능하다.
    }
  }
}
```

>## 익명 내부 클래스 

클래스 재사용할 필요 없고, 구현한 인터페이스 타입으로만 사용시 유용  
클래스 이름 없앨 수 있음  
이름이 없으므로 클래스 자신의 타입을 가질 수 없음, 구현한 인터페이스 타입의 변수에만 저장 가능  
생성자처럼 이용하여 오브젝트를 만듬  
```java
//한 번만 사용하므로 변수에 넣을 필요없이 곧바로 매개변수에 넣음
함수이름(new 인터페이스타입(){
    public 반환형 함수이름(){~~}
  }
}
```

>## 인터페이스 없이 DI 적용

### 1. 스프링 빈으로 DI
인터페이스를 사용하지 않는 이유 :  강한 관계성이 있음  

인터페이스가 아닌 DI 구조로 만들어야 하는 이유  
1. 싱글톤 빈이므로 : 서비스 오브젝트로서 의미 있음. 공유되는 것이 이상적  
2. DI를 통해 다른 빈에 의존하고 있으므로. 다른 빈을 DI 받기 위해서라도 빈으로 등록  

장점 : 의존관계가 설정파일에 드러남  
단점 : 구체적인 클래스와의 관계가 설정에 노출  

### 2. 수동 DI
클라이언트 오브젝트 내부에서 직접 DI 적용  
싱글톤 빈 포기  
클라이언트 오브젝트마다 하나의 오브젝트를 가지게 함  
컨텍스트가 스프링 빈이 아니므로 이를 클라이언트 오브젝트가 직접 생성, 초기화  

장점 : 강한 관계지만 분리되어 있는 것을 내부에 직접 만들어 사용, 다른 오브젝트에 대한 DI 적용 가능, 재부에 생성되면서 관계를 드러내지 않음  
단점 : 컨텍스트가 여러 오브젝트에 사용되도 싱글톤으로 못 만듬, DI를 위한 추가 코드 필요  

>## 템플릿/콜백 패턴

템플릿 : 전략 패턴의 컨택스트. 미리 만들어둔 틀  
콜백 : 익명 내부 클래스로 만들어지는 오브젝트. 다른 오브젝트의 메소드에 전달되는 오브젝트  